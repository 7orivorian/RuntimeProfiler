<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>$title</title>
    <style>
        body {
            background-color: #2c3539;
            color: #bcbec4;
        }

        #table {
            margin-top: 30px;
        }

        table {
            border-collapse: collapse;
            border: 2px solid #bcbec4;
            font-family: sans-serif;
            font-size: 0.8rem;
            letter-spacing: 1px;
        }

        caption {
            caption-side: top;
            padding: 10px;
            font-weight: bold;
        }

        thead,
        tfoot {
            background-color: #274a5e;
        }

        th,
        td {
            border: 1px solid #bcbec4;
            padding: 8px 10px;
        }

        td:last-of-type {
            text-align: center;
        }

        tbody > tr:nth-of-type(odd) {
            background-color: #23344b;
        }

        tbody > tr:nth-of-type(even) {
            background-color: #263f58;
        }

        tfoot th {
            text-align: right;
        }

        tfoot td {
            font-weight: bold;
        }

        footer {
            margin-top: 50px;
            font-size: 0.8rem;
        }

        a {
            color: #4c86a9;
        }

        .copyable {
            cursor: pointer;
        }

        #options {

        }
    </style>
</head>
<body>
<header>
    <h1>Profiler â€” <a class="copyable">$label</a></h1>
    <h3 id="dateheader">Generated on <a class="copyable">$date</a></h3>
</header>
<div id="options">
    <label for="simple-dropdown">TimeUnit Override</label>
    <select id="simple-dropdown">
        <option value="none" selected>none</option>
        <option value="ns">ns (nanoseconds)</option>
        <option value="us">us microseconds</option>
        <option value="ms">ms (milliseconds)</option>
        <option value="s">s (seconds)</option>
        <option value="m">m (minutes)</option>
        <option value="h">h (hours)</option>
        <option value="d">d (days)</option>
    </select>
</div>
<div id="table">
    <table>
        <!--@formatter:off-->
        <caption>
            Timed with <a id="timeunit">$timeunit (<originalunit>$abbrtimeunit</originalunit>)</a> precision
        </caption>
        <!--@formatter:on-->
        <thead>
        $tableheader
        </thead>
        <tbody>
        $tablebody
        </tbody>
    </table>
</div>
<p>Estimated profiler overhead: <a><duration unit="$abbrtimeunit" original="$est_overhead">$est_overhead</duration></a></p>
<footer>
    Generated by <a href="https://github.com/7orivorian/RuntimeProfiler">RuntimeProfiler</a>
</footer>
</body>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.copyable').forEach(element => {
            element.addEventListener('click', () => {
                copyToClipboard(element.textContent);
            });
        });

        const defaultTimeUnit = document.querySelector('originalunit').textContent;

        const dropdown = document.querySelector('#simple-dropdown');

        dropdown.addEventListener('change', () => {
            const selectedOption = dropdown.options[dropdown.selectedIndex].value;
            switch (selectedOption) {
                case "none": {
                    document.querySelectorAll('duration').forEach(element => {
                        element.textContent = element.getAttribute('original');
                    });
                    document.querySelectorAll('unitabbr').forEach(element => {
                        element.textContent = defaultTimeUnit;
                    });
                    break;
                }
                default: {
                    document.querySelectorAll('duration').forEach(element => {
                        const unit = element.getAttribute('unit');
                        const val = parseInt(element.getAttribute('original'));
                        element.textContent = convertTimeUnit(val, unit, selectedOption);
                    });
                    document.querySelectorAll('unitabbr').forEach(element => {
                        element.textContent = selectedOption;
                    });
                    break;
                }
            }
        });
    });

    function convertTimeUnit(value, fromUnit, toUnit) {
        const units = {
            'ns': 1e-9,
            'us': 1e-6,
            'ms': 1e-3,
            's': 1,
            'm': 60,
            'h': 3600,
            'd': 86400
        };
        const seconds = value * units[fromUnit];
        const convertedValue = seconds / units[toUnit];
        let fixed = convertedValue.toFixed(3);
        if (fixed.includes(".")) {
            fixed = fixed.replace(/\.?0*$/, '');
            if (fixed.endsWith('.')) {
                fixed = fixed.slice(0, -1);
            }
        }
        return fixed;
    }

    function copyToClipboard(text) {
        if (!navigator.clipboard) {
            console.error('Clipboard API not supported');
            return;
        }

        navigator.clipboard.writeText(text).catch(err => {
            console.error('Could not copy text: ', err);
        });
    }
</script>
</html>